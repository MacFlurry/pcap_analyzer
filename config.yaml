# Configuration des seuils pour l'analyse de latence réseau

# Seuils généraux
thresholds:
  # Délai anormal entre paquets (secondes)
  # Détecte les "trous" dans la capture ou les pauses applicatives longues
  packet_gap: 1.0

  # Handshake TCP
  # Temps entre le SYN (client) et le SYN-ACK (serveur)
  syn_synack_delay: 0.1  # 100ms - Au-delà, le serveur est lent ou le réseau sature
  # Temps total pour les 3 étapes (SYN -> SYN-ACK -> ACK)
  handshake_total: 0.3   # 300ms

  # Retransmissions SYN
  # Délai avant de considérer qu'une tentative de connexion échoue ou traîne trop
  syn_retrans_threshold: 2.0  # secondes

  # RTT (Round Trip Time)
  # Latence réseau estimée entre la capture et l'autre extrémité
  rtt_warning: 0.1       # 100ms - Latence élevée
  rtt_critical: 0.5      # 500ms - Latence critique (impact utilisateur fort)

  # Retransmissions TCP
  # Logique hybride : Il faut dépasser le seuil absolu (low) ET le seuil de taux (%)

  # 1. Seuils absolus (Nombre de paquets retransmis)
  # Minimum requis pour déclencher une alerte (évite les faux positifs sur les très petits flux)
  retransmission_low: 10      # Augmenté de 5 à 10 pour réduire le bruit sur les petits flux
  retransmission_medium: 50
  retransmission_critical: 100 # Si ce nombre est atteint, on alerte même si le taux est bas (volume important)

  # 2. Seuils relatifs (Taux de perte en %)
  # C'est le critère principal de sévérité une fois le seuil absolu 'low' dépassé
  retransmission_rate_low: 1.0       # 1% de perte - Début de dégradation
  retransmission_rate_medium: 3.0    # 3% de perte - Impact notable sur le débit
  retransmission_rate_critical: 5.0  # 5% de perte - Connexion instable / inutilisable

  # TCP Window
  # Taille de fenêtre (en octets) considérée comme "basse", risquant de limiter le débit
  low_window_threshold: 8192  # 8 KB
  # Durée pendant laquelle la fenêtre reste à 0 (blocage de l'émetteur)
  zero_window_duration: 0.1   # 100ms

  # DNS
  dns_response_warning: 0.1   # 100ms
  dns_response_critical: 1.0  # 1s
  dns_timeout: 5.0            # 5s - Standard pour un timeout client

# Configuration SSH pour capture distante
ssh:
  host: "192.168.1.100"  # IP du serveur distant
  port: 22
  username: "your_username"
  # SECURITY WARNING: Never use password authentication in production!
  # Password authentication is disabled by design - use key-based auth only
  key_file: "~/.ssh/id_rsa"  # Chemin vers votre clé SSH privée (REQUIRED)

  # Paramètres tcpdump
  tcpdump:
    interface: "any"
    filter: "host 192.168.1.50"  # Exemple : filtrer par IP
    snaplen: 65535
    buffer_size: 4096

# Configuration des rapports
reports:
  output_dir: "reports"
  formats:
    - json
    - html
  include_pcap_summary: true
  max_flows_displayed: 50

# PII Redaction Configuration (GDPR/NIST Compliance)
# Prevents privacy violations by sanitizing logs
logging:
  pii_redaction:
    # SECURITY: MUST be true in production environments
    # GDPR Art. 5(1)(c): Data Minimization - IP addresses are PII under EU law
    # CWE-532: Insertion of Sensitive Information into Log File
    # NIST SP 800-122: Guide to Protecting PII
    enabled: true

    # Redaction levels:
    # - PRODUCTION: Redact all PII (IP addresses, MAC addresses, file paths, credentials)
    #               Preserves first 2 octets of IPv4 for network debugging (e.g., 192.168.XXX.XXX)
    # - DEVELOPMENT: Keep IP addresses for debugging, redact credentials
    # - DEBUG: No redaction (WARNING: NOT GDPR-COMPLIANT - use only in isolated dev environments)
    level: "PRODUCTION"

    # Preserve network prefixes in redacted IPs for troubleshooting
    # e.g., 192.168.1.1 -> 192.168.XXX.XXX instead of [IP_REDACTED]
    preserve_network_prefixes: true

    # Legal basis for logging (GDPR Art. 6)
    # Legitimate interest: Security monitoring, incident response, performance analysis
    legal_basis: "legitimate_interest_security_monitoring"

    # Data retention policy (GDPR Art. 5(1)(e): Storage Limitation)
    # Logs containing PII should be retained only as long as necessary
    retention_days: 90  # Adjust based on your compliance requirements

    # Audit logging configuration
    # SECURITY CRITICAL: Audit logs contain unredacted PII
    # Must be encrypted, access-controlled, and compliant with retention policies
    audit_log:
      enabled: false  # Enable only if you have secure audit infrastructure
      path: "/var/log/pcap_analyzer/secure_audit.log"  # Must be encrypted storage
      encryption_required: true
      access_control: "security_team_only"
      retention_days: 365
