# Agent Notes - pcap_analyzer
## Date: 4 dÃ©cembre 2025

---

## âœ… CE QUI A Ã‰TÃ‰ FAIT

### 1. Correction de la dÃ©tection des retransmissions (TERMINÃ‰)
- **ProblÃ¨me**: L'outil ne dÃ©tectait que 11 retransmissions sur 22 (uniquement le sens Clientâ†’Serveur).
- **Cause**: 
  1. La mÃ©thode `highest_seq` ne prenait pas en compte les purs ACKs pour mettre Ã  jour l'Ã©tat du sÃ©quenceur.
  2. Le serveur envoyait un ACK avec `Seq=X`, puis des donnÃ©es avec `Seq < X` (retransmission). Comme l'ACK Ã©tait ignorÃ© pour le tracking `highest_seq`, la retransmission n'Ã©tait pas vue comme un retour en arriÃ¨re.
- **Solution**:
  - Mise Ã  jour de `highest_seq` pour **tous** les paquets TCP (y compris ACKs sans payload).
  - Ajout de la rÃ©initialisation de l'Ã©tat sur dÃ©tection de SYN (pour gÃ©rer la rÃ©utilisation de ports).
  - Ajout de la dÃ©tection "Spurious Retransmission" (Seq < Max ACK vu).
  - Ajout de la dÃ©tection "Fast Retransmission" (basÃ©e sur 3 DUP ACKs).

### 2. RÃ©sultat
- **Avant**: 11 retransmissions dÃ©tectÃ©es.
- **AprÃ¨s**: 22 retransmissions dÃ©tectÃ©es (11 Clientâ†’Serveur + 11 Serveurâ†’Client).
- **Correspondance Wireshark**: Parfaite (22 paquets marquÃ©s comme retransmissions).

---

## ğŸ“ Ã‰TAT DU REPO

- **Branche**: main
- **Fichier modifiÃ©**: `src/analyzers/retransmission.py`
- **Test validÃ©**: `worker-test.pcap`

### 3. AmÃ©lioration de la logique de sÃ©vÃ©ritÃ© (EN COURS)
- **Demande**: Passer d'un seuil absolu (ex: 30 retransmissions = critique) Ã  un seuil relatif (pourcentage).
- **Raison**: 30 retransmissions sur 50 paquets est grave (60%), mais 30 sur 2000 est nÃ©gligeable (1.5%).
- **ImplÃ©mentation**:
  - Ajout de seuils de taux dans `config.yaml` (1%, 3%, 5%).
  - Modification de `RetransmissionAnalyzer` pour calculer le taux (`retrans / total * 100`).
  - Logique hybride : Il faut un minimum absolu (ex: 5) pour activer l'alerte, puis le niveau de sÃ©vÃ©ritÃ© dÃ©pend du taux.
  - Fallback : Si le nombre absolu est trÃ¨s Ã©levÃ© (ex: > seuil critique absolu), on garde une sÃ©vÃ©ritÃ© 'low' mÃªme si le taux est bas, pour signaler le volume.

---

## ğŸ“š NOTES TECHNIQUES

### Pourquoi les retransmissions Serveurâ†’Client Ã©taient invisibles ?
Le serveur envoyait un ACK (Len=0) avec `Seq=6475`. Cela indiquait qu'il Ã©tait "rendu" Ã  6475.
Ensuite, il envoyait un paquet de donnÃ©es avec `Seq=6449`.
C'est une retransmission (6449 < 6475).
Mais notre code ignorait le `Seq` des paquets sans payload (ACKs), donc il ne savait pas que le serveur avait dÃ©jÃ  atteint 6475.
En traitant le `Seq` de tous les paquets, le "retour en arriÃ¨re" est correctement dÃ©tectÃ©.
